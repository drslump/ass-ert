!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.ass=e()}}(function(){var define;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(global){function ass(value){return 0===arguments.length?new Chain:new Chain(value)}var _="undefined"!=typeof window?window._:"undefined"!=typeof global?global._:null,Chain=require("./chain"),Matcher=require("./matcher"),Expectation=require("./expectation"),util=require("./util"),defProp=util.bind(Object.defineProperty,Object);ass._=function(value){return new Chain(value)._},ass.matchers=[],defProp(ass,"help",{get:function(){var s="";return _.forEach(ass.matchers,function(matcher){var fn=matcher.test.toString(),args=fn.replace(/^function\s*\(([^\)]*)\)[\S\s]*/,"$1");args=args.split(",").map(function(x){return x.trim()}),args.shift(),fn=args.length?" ("+args.join(", ")+")":"",s+="> ."+matcher.name+fn+"\n\n",s+="  "+matcher.help.replace(/\n/g,"\n  "),s+="\n\n"}),s}}),ass.ok=function(cond,message){return 1===arguments.length&&(message="expected a truish value"),ass.desc(message).truthy.assert(cond,ass.ok),cond},ass.ko=function(cond,message){return 1===arguments.length&&(message="expected a falsy value"),ass.desc(message).falsy.assert(cond,ass.ko),cond},ass.marks=function(){var expected=arguments[0],desc=arguments[1];return"undefined"==typeof expected?(expected=ass.marks.counter,ass.marks.counter=0,expected):void ass.desc(desc||"ass.marks").eq(expected).assert(ass.marks.counter,ass.marks)},ass.marks.counter=0,ass.register=function(name,matcher){if(name instanceof Matcher)matcher=name,name=matcher.name;else{if("object"==typeof name)return void Object.keys(name).forEach(function(key){ass.register(key,name[key])});_.forEach(matcher.aliases,function(alias){ass.register(new Matcher(alias,matcher))}),matcher=new Matcher(name,matcher)}ass.matchers.push(matcher);var fnKey=1===matcher.arity?"get":"value",prop={configurable:!1,enumerable:!0};"value"===fnKey&&(prop.writable=!1),prop[fnKey]=function fn(){var exp=new Expectation(matcher,arguments);return this.__expectations__.push(exp),this.__deferred__||this.assert(this.value,fn),this},defProp(Chain.prototype,name,prop),prop[fnKey]=function(){var chain=new Chain;return"get"===fnKey?chain[name]:chain[name].apply(chain,arguments)},defProp(ass,name,prop),prop[fnKey]=function passthrough(){return this[name].assert(this.value,passthrough).valueOf()},prop.enumerable=!1,defProp(Chain.prototype,"$"+name,prop),defProp(ass,"$"+name,{value:function(value){if("get"===fnKey)return ass(value)["$"+name];var chain=new Chain;return chain[name].apply(chain,arguments),chain.through},enumerable:!1})},module.exports=ass}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./chain":2,"./expectation":4,"./matcher":5,"./util":13}],2:[function(require,module,exports){(function(global){function Chain(value){if(!Chain.isChain(this))throw new Error("Ass Chain constructor called without new!");this.value=arguments.length>0?value:this.__GUARD__,defProp(this,"__description__",{value:"",enumerable:!1,configurable:!1,writable:!0}),defProp(this,"__expectations__",{value:[],enumerable:!1,configurable:!1,writable:!1}),defProp(this,"__deferred__",{value:this.value===this.__GUARD__,enumerable:!1,configurable:!1,writable:!0}),defProp(this,"__thens__",{value:[],enumerable:!1,configurable:!1,writable:!1}),this.test=util.bind(Chain.prototype.test,this),this.assert=util.bind(Chain.prototype.assert,this),this.result=util.bind(Chain.prototype.result,this),this.through=util.bind(Chain.prototype.through,this),this.$=this.through}function dumpChain(resolved,indent){var result="";return indent=indent||"",resolved.forEach(function(exp,idx){return Array.isArray(exp)?void(result+=dumpChain(exp,indent+"  ")):exp.result?void(result+=indent+" [32mPassed:[0m "+exp.description+"\n"):(result+=indent+" [31mFailed:[0m "+exp.description+"\n",void(idx===resolved.length-1&&(result+=indent+"    [33mBut:[0m "+exp.failure+"\n")))}),result}var _="undefined"!=typeof window?window._:"undefined"!=typeof global?global._:null,resolvers=require("./resolvers"),AssError=require("./error"),util=require("./util"),Promise=util.Promise,defProp=util.bind(Object.defineProperty,Object);Chain.isChain=function(obj){return obj&&obj.constructor===Chain};var proto=Chain.prototype=Object.create(null);proto.constructor=Chain,proto.__GUARD__={valueOf:function(){return this.toString()},toString:function(){return"{{valueless}}"}},defProp(proto,"help",{get:function(){var tail=_.tail(this.__expectations__);return tail?tail.help:"N/A"}}),defProp(proto,"_",{get:function fn(){return this.__deferred__?(this.__deferred__=!1,this.assert(this.value,fn)):this.__deferred__=!0,this}}),proto.then=function(cb,eb){if(this.__thens__.push([cb,eb]),!this.__deferred__&&this.value!==this.__GUARD__){var resolver=resolvers.acquire(this);resolver(this.value)}return this},proto["catch"]=function(eb){return this.then(null,eb)},proto.dispatchResult=function(resolved,result){if(0!==this.__thens__.length){var actual=this.value;result===!1&&(actual=this.buildError(resolved,proto.dispatchResult));var promise=new Promise(function(resolve,reject){actual&&"function"==typeof actual.then&&(actual=["Ass: Value wrapped in an array since it looks like a Promise",actual]),(result?resolve:reject)(actual)});_.forEach(this.__thens__,function(callbacks){promise=promise.then.apply(promise,callbacks)})}},proto.buildError=function(resolved,ssf){var error=this.__description__+"\n\n";exp=resolved[resolved.length-1],error+=dumpChain(resolved),util.doColors()||(error=util.unansi(error));var expected=exp.expected;"function"==typeof expected&&(expected=null);var inst=new AssError(error,ssf||arguments.callee||proto.buildError);return inst.showDiff=!1,inst.actual=null,inst.expected=null,inst},proto.test=function(actual){0===arguments.length&&(actual=this.value);var resolver=resolvers.acquire(this),result=resolver(actual);return result},proto.assert=function(actual,ssf){if(0===arguments.length&&(actual=this.value),actual===this.__GUARD__)return this;var resolver=resolvers.acquire(this),result=resolver(actual);if(result===!1)throw this.buildError(resolver.resolved,ssf||this.assert);return void 0===result&&(this.__deferred__=!0),this},proto.through=function(actual){return this.assert(actual,proto.through),actual},proto.result=function(actual){var result;0===arguments.length&&(actual=this.value);try{this.tap(function(value){result=value}).test(actual)}finally{this.__expectations__.pop()}return result},Chain.prototype.valueOf=function(){return this.value},Chain.prototype.toString=function(){if(this.__description__)return this.__description__;var descs=this.__expectations__.filter(function(c){return c.description}).map(function(c){return c.description});return descs.length>1?"("+descs.join(", ")+")":1===descs.length?descs[0]:"<AssChain>"},module.exports=Chain}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./error":3,"./resolvers":11,"./util":13}],3:[function(require,module,exports){function getTargetLine(frames){function getSrc(frame){var fn=frame.getFunction();return fn?fn.toString().replace(/\s+/g,""):null}if(!frames.length)return null;var target=frames[0],targetSrc=getSrc(target);if(!targetSrc)return null;samefile=frames.filter(function(frame){return frame&&frame.getFileName()===target.getFileName()});for(var wrapper,i=1;i<samefile.length;i++){var src=getSrc(samefile[i]);if(src&&-1!==src.indexOf(targetSrc)){wrapper=samefile[i];break}}if(wrapper){var relLn=target.getLineNumber()-wrapper.getLineNumber(),lines=(target.getLineNumber()===wrapper.getLineNumber()?0:target.getColumnNumber()-1,target.getFunction().toString().split(/\n/));if(lines[relLn])return lines[relLn]}return null}var Failure=require("failure"),unansi=require("./util").unansi,AssError=Failure.create("AssError"),proto=AssError.prototype;AssError.Failure=Failure,proto.showDiff=!1,proto.actual=null,proto.expected=null,proto.toJSON=function(stack){var props={name:this.name,message:unansi(this.message),actual:this.actual,expected:this.expected,showDiff:this.showDiff};return stack&&this.stack&&(props.stack=this.stack),props},proto.toString=function(){var msg=Failure.prototype.toString.call(this),line=getTargetLine(this.frames);return line&&(msg+="\n  >> "+line.replace(/^\s+/,"").slice(0,60)+"\n"),msg},module.exports=AssError},{"./util":13,failure:19}],4:[function(require,module,exports){(function(global){function Expectation(matcher,args){matcher.assign(this),this.args=_.toArray(args),this.actual=void 0}var _="undefined"!=typeof window?window._:"undefined"!=typeof global?global._:null,Matcher=(require("./chain"),require("./matcher")),template=require("./util").template,proto=Expectation.prototype=Object.create(Matcher.prototype);proto.constructor=Expectation,Object.defineProperty(proto,"expected",{get:function(){return this.args[0]},set:function(v){Object.defineProperty(this,"expected",{value:v})}}),_.times(5,function(i){Object.defineProperty(proto,"arg"+(i+1),{get:function(){return this.args[i]}})}),Object.defineProperty(proto,"description",{get:function(){return this.desc?"function"==typeof this.desc?this.desc(this):template(this.desc,this):null}}),Object.defineProperty(proto,"failure",{get:function(){return"function"==typeof this.fail?this.fail(this):template(this.fail,this)}}),Expectation.prototype.mutate=function(value){return function(resolver){return resolver(value)}},Expectation.prototype.resolve=function(){var args,result;return args=[this.actual].concat(this.args),result=this.test.apply(this,args),"string"==typeof result&&(this.fail=result,result=!1),result},Expectation.prototype.toString=function(){return this.description},module.exports=Expectation}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./chain":2,"./matcher":5,"./util":13}],5:[function(require,module,exports){function Matcher(name,descriptor){if("function"==typeof descriptor&&(descriptor={test:descriptor}),this.name=name,Array.isArray(descriptor.help)?this.help=descriptor.help.join("\n"):this.help=descriptor.help||"Not available",this.desc=void 0!==descriptor.desc?descriptor.desc:this.name,this.fail=descriptor.fail||"was {{ actual }}",!descriptor.test)throw new Error("test function not defined for the matcher");this.test=descriptor.test,this.arity=void 0!==descriptor.arity?descriptor.arity:this.test.length}Matcher.prototype=Object.create(null),Matcher.prototype.constructor=Matcher,Matcher.prototype.clone=function(){return new this.constructor(this.name,{help:this.help,desc:this.desc,fail:this.fail,test:this.test,arity:this.arity})},Matcher.prototype.assign=function(obj){obj.help=this.help,obj.desc=this.desc,obj.fail=this.fail,obj.test=this.test,obj.arity=this.arity},Matcher.prototype.toString=function(){return"<Ass.Matcher "+this.name+">"},module.exports=Matcher},{}],6:[function(require,module,exports){(function(global){function wrapArgs(args){return _.toArray(args).slice(1).map(function(branch){return ass.Chain.isChain(branch)?branch:ass.eql(branch)})}var _="undefined"!=typeof window?window._:"undefined"!=typeof global?global._:null,ass=require("../ass");ass.register({and:{help:["Composes a new expectation from two or more expressions, which will only","succeed if all the expressions that form it do indeed succeed.","Note: evaluation will stop as soon as one of the expressions fails."],desc:'${ args.join(" AND ") }',fail:"was {{ actual }}",test:function(actual,branch1,branch2){var branches=wrapArgs(arguments);return function(resolver){var undefs=0,result=_.every(branches,function(branch){var partial=branch.test(actual);return void 0===partial?(resolver.paused||resolver.pause(),undefs+=1,branch.then(_.once(function(){undefs-=1,0===undefs&&resolver.resume(actual)}),_.once(function(){resolver.resume(null,!1)})),!0):partial});return resolver.paused?void 0:(result===!0&&(result=resolver(actual)),result)}}},or:{help:["Composes a new expectation from two or more expressions, which will only","succeed if at least one of the expressions does.","Note: evaluation will stop as soon as one of the expressions succeeds."],desc:'${ args.join(" OR ") }',fail:"was {{ actual }}",test:function(actual,branch1,branch2){var branches=wrapArgs(arguments);return function(resolver){var undefs=0,result=_.some(branches,function(branch){var partial=branch.test(actual);return void 0===partial?(resolver.paused||resolver.pause(),undefs+=1,branch.then(_.once(function(){resolver.resume(actual)}),_.once(function(){undefs-=1,0===undefs&&resolver.resume(null,!1)})),!1):partial});return resolver.paused?void 0:(result===!0&&(result=resolver(actual)),result)}}},xor:{help:["Composes a new expectation from two or more expressions, which will only","succeed if at least one of the expressions does but not all of them."],desc:'${ args.join(" XOR ") }',fail:"was {{ actual }}",test:function(actual,branch1,branch2){var branches=wrapArgs(arguments);return function(resolver){var undefs=0,oks=0,kos=0;return _.forEach(branches,function(branch){var partial=branch.test(actual);void 0===partial?(resolver.paused||resolver.pause(),undefs+=1,branch.then(_.once(function(){return kos>0?void resolver.resume(actual):(oks+=1,undefs-=1,void(0===undefs&&resolver.resume(actual,oks>0&&kos>0?void 0:!1)))}),_.once(function(){return oks>0?void resolver.resume(actual):(kos+=1,undefs-=1,void(0===undefs&&resolver.resume(actual,oks>0&&kos>0?void 0:!1)))}))):partial===!0?oks+=1:partial===!1&&(kos+=1)}),resolver.paused?void 0:oks>0&&kos>0?resolver(actual):!1}}}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../ass":1}],7:[function(require,module,exports){(function(global){var _="undefined"!=typeof window?window._:"undefined"!=typeof global?global._:null,ass=require("../ass"),util=require("../util");ass.register({desc:{help:"Provide a custom description for reported failures",desc:null,test:function(actual,desc){return function(resolver){return resolver.chain.__description__=desc,resolver(actual)}}},to:{aliases:["a","an","be"],help:["Just some syntax sugar to make the expectations easier on the eyes."],desc:null,test:function(actual){return!0}},mark:{help:["Increases the global `ass.marks` counter every time it gets","evaluated as part of an expression. Use it to verify that the","preceding expectations are actually being executed.","An easy way to support this when using a test runner is to reset","the counter by calling `ass.marks()` on a beforeEach hook and","then verify at the end of test with `ass.marks(N)` (where N is","the number of marks you expected)."],desc:null,test:function(actual){return ass.marks.counter+=1,!0}},any:{help:"Allows any value without testing it.",desc:"is anything",test:function(actual){return!0}},defined:{help:"Checks if the value is not null or undefined.",desc:"is defined",fail:"was ${ actual }",test:function(actual){return null!=actual}},empty:{help:"Checks if the value is empty (or has a length of 0).",desc:"is empty",fail:"was ${ actual }",test:function(actual){return null==actual||0===actual.length}},nempty:{aliases:["nonEmpty"],help:"Checks if the value is not empty (or has a length greater than 0).",desc:"is not empty",fail:"was ${ actual }",test:function(actual){return null!=actual&&actual.length>0}},truthy:{aliases:["truish"],help:'The value should be truthy (not undefined, null, 0, "" or []).',desc:"is truthy",fail:"was ${ actual }",test:function(actual){return actual?"number"==typeof actual.length?actual.length>0:!0:!1}},falsy:{help:'The value should be falsy (undefined, null, 0, "" or []).',desc:"is falsy",fail:"was {{ actual }}",test:function(actual){return actual?"number"==typeof actual.length?0===actual.length:!1:!0}},not:{aliases:["no","NO","NOT"],help:"Negates the result for the rest of the expression.",desc:"Not!",fail:"was {{ actual }}",test:function(actual){return function(resolver){return resolver.exhausted?!0:(resolver.finalize(function(final){return!final}),resolver(actual))}}},is:{aliases:["equal","equals"],help:["Checks strict equality between the value and its expected.","Note: if the expected value is a chain expression it'll be tested instead."],desc:"to strictly equal {{expected}}",fail:"was {{actual}}",test:function(actual,expected){return ass.Chain.isChain(expected)?expected.test(actual):actual===expected}},eq:{aliases:["eql","eqls"],help:["Checks deep non-strict equality between the value and its expected.","It understands ass expressions so you can combine them at will in the","expected value."],desc:"to equal {{expected}}",fail:"was {{actual}}",test:function(actual,expected){return _.isEqual(actual,expected)}},match:{help:["Tries to match the subject against the expected value which can be either","a function, an ass expression, an object with a .test() function (for ","instance a RegExp) or a plain object to partially match against the value."],desc:"to match {{expected}}",fail:"was {{actual}}",test:function(actual,expected){if("function"==typeof expected.test)return!!expected.test(actual);if(_.isPlainObject(expected)||_.isArray(expected)||_.isArguments(expected)){if(null==actual)return!1;(_.isArray(expected)||_.isArguments(expected))&&(expected=_.map(expected,function(v){return"undefined"==typeof v?ass.any:v}));var failure=!0;return _(expected).every(function(value,key){return _.has(actual,key)?_.isEqual(actual[key],value)?!0:(failure='key "'+key+'" does not match {{actual["'+key+'"]}}',!1):(failure='key "'+key+'" not found in {{actual}}',!1)}),failure}return"function"!=typeof expected?"expected is not a function and does not have a .test method":!!expected(actual)}},above:{aliases:["gt","moreThan","greaterThan"],help:"Checks if the value is higher than its expected.",desc:"to be more than {{expected}}",fail:"was {{actual}}",test:function(actual,expected){return actual>expected}},below:{aliases:["lt","lessThan"],help:"Checks if the value is lower tha its expected.",desc:"to be less than {{expected}}",fail:"was {{actual}}",test:function(actual,expected){return expected>actual}},aboveOrEqual:{aliases:["least","atLeast","gte","moreThanOrEqual","greaterThanOrEqual"],help:"Checks if the value is higher or equal than its expected.",desc:"to be more than or equal to ${expected}",fail:"was {{actual}}",test:function(actual,expected){return actual>=expected}},belowOrEqual:{aliases:["most","atMost","lte","lessThanOrEqual"],help:"Checks if the value is lower or equal than its expected.",desc:"to be less than or equal to ${expected}",fail:"was ${actual}",test:function(actual,expected){return expected>=actual}},close:{aliases:["closeTo"],help:["Checks if the value is close to the expected based on a given delta.","The default delta is 0.1 so the value 3.55 is close to any value between","3.45 and 3.65 (both inclusive).","String values are also supported by computing the distance between them","using the Sift4 algorithm. For string values the delta is interpreted as","a percentage (ie: 0.25 is 25%)."],desc:"to be close to {{ expected }}",fail:"was {{ actual }}",test:function(actual,expected,delta){if(delta=null==delta?.1:delta,_.isString(actual)&&_.isString(expected)){var diff=util.sift4(actual,expected,3)/Math.max(actual.length,expected.length);return delta>=diff}return actual>=expected-delta&&expected+delta>=actual}},"instanceof":{aliases:["instanceOf","instance","isa"],help:["Checks if the value is an instance of the given constructor.","When the expected is a string it'll actually use a `typeof`","comparison."],desc:"to be an instance of {{expected}}",test:function(actual,expected){return _.isString(expected)?typeof actual===expected?!0:"had type {{ typeof actual }}":actual instanceof expected}},"typeof":{help:"Checks if the value is of a specific type",desc:"to have type {{expected}}",fail:"had ${ typeof actual }",test:function(actual,expected){return _.isEqual(typeof actual,expected)}},number:{help:"Check if the value is a number (different of NaN).",desc:"to be a number",fail:"had type ${ typeof actual }",test:function(actual){return _.isNumber(actual)&&!isNaN(actual)}},bool:{aliases:["boolean"],help:"Check if the value is a boolean.",desc:"to be a boolean",fail:"had type ${ typeof actual }",test:function(actual){return _.isBoolean(actual)}},string:{aliases:["str"],help:"Check if the value is a string.",desc:"to be a string",fail:"had type ${ typeof actual }",test:function(actual){return _.isString(actual)}},object:{help:"Check that value is of type object.",desc:"to be an object",fail:"had type ${ typeof actual }",test:function(actual){return _.isObject(actual)}},plainObject:{aliases:["plain","obj"],help:"Checks that value is an object created by the Object constructor.",fail:"was ${actual}",test:function(actual){return _.isPlainObject(actual)}},array:{help:"Check that value is an Array.",desc:"to be an Array",fail:"had type ${ typeof actual }",test:function(actual){return _.isArray(actual)}},"function":{help:"Check that value is a Function.",desc:"to be a Function",fail:"had type ${ typeof actual }",test:function(actual){return _.isFunction(actual)}},regexp:{help:"Check that value is a RegExp",desc:"to be a RegExp",fail:"had type ${ typeof actual }",test:function(actual){return _.isRegExp(actual)}},date:{help:"Check that value is a Date",desc:"to be a Date",fail:"had type ${ typeof actual }",test:function(actual){return _.isDate(actual)}},element:{help:"Check that value is a DOM element",desc:"to be a DOM element",test:function(actual){return _.isElement(actual)}},error:{help:"Check that value is an error (or looks like it)",desc:"to be an Error",test:function(actual){return actual instanceof Error?!0:_.isObject(actual)&&_.isString(actual.name)&&_.isString(actual.message)}},undefined:{help:"Check that value is undefined.",desc:"to be undefined",fail:"was ${ actual }",test:function(actual){return _.isUndefined(actual)}},"null":{help:"Check that value is null.",desc:"to be null",fail:"was ${ actual }",test:function(actual){return null===actual}},NaN:{help:"Check that value is NaN.",desc:"to be NaN",test:function(actual){return _.isNumber(actual)?this.fail="was ${actual}":this.fail="had type ${typeof actual}",isNaN(actual)}},"true":{help:"Check that value is true",desc:"to be true",fail:"was {{ actual }}",test:function(actual){return _.isBoolean(actual)?actual?!0:"was {{actual}}":"had type ${typeof actual}"}},"false":{help:"Check that value is false",desc:"to be false",test:function(actual){return _.isBoolean(actual)?actual?"was {{actual}}":!0:"had type ${typeof actual}"}},raises:{aliases:["throws"],help:["Checks that executing the value results in an exception being thrown.","The captured exception value is used to mutate the subject for the","following expectations."],desc:"throws an error",test:function(actual,expected){if(!_.isFunction(actual))return"is not a function: {{actual}}";try{return actual(),"did not throw anything"}catch(e){return null==expected?this.mutate(e):_.isFunction(expected)&&e instanceof expected?this.mutate(e):_.isEqual(e,expected)?this.mutate(e):(this.exception=e,"got {{ exception }}")}}},has:{aliases:["have","contain","contains"],help:["Check if the value has some expected value. It understands expected","chain expressions so this serves as the equivalent of .eq for partial","matches."],desc:"to contain {{expected}}",fail:"was {{actual}}",test:function(actual,arg1){var expected=_.toArray(arguments).slice(1);return this.expected=1===expected.length?expected[0]:expected,_.isString(actual)||_.isArray(actual)||_.isObject(actual)?_.every(expected,function(expected){return _.isString(actual)&&_.isString(expected)?-1!==actual.indexOf(expected):_.isArray(actual)?(ass.Chain.isChain(expected)||(expected=ass.eq(expected)),-1!==_.findIndex(actual,expected)):1===_.where([actual],expected).length}):"got {{actual}}"}},hasOwn:{aliases:["hasKey","hasIndex"],help:["Check if the value has one or more own properties as defined by","the given arguments."],desc:"to have own property ${ expected }",test:function(actual,expected){if(!_.isObject(actual))return"was {{actual}}";this.fail="only had {{ _.keys(actual) }}";var args=_.toArray(arguments).slice(1);return _.every(args,function(x){return _.has(actual,x)})}},log:{help:["Dumps the received value to the console."],desc:null,test:function(actual){return console.log("[ASS]",actual),!0}},dump:{help:["Dumps the received value to the console applying the given template.","Note: Use ${this} to interpolate the whole value.","See: https://lodash.com/docs#template"],desc:null,test:function(actual,tpl){var result=util.template.call(actual,tpl,actual);return console.log(result),!0}},"debugger":{help:["Halts script execution by triggering the interactive debugger."],desc:null,test:function(actual){return!0}},tap:{aliases:["fn"],help:["Calls the provided function with the current value as argument.","If the function returns something different to *undefined* the","expression will fork to operate on the returned value."],desc:"call {{arg1}}",test:function(actual,fn){var result=fn(actual);return"undefined"!=typeof result?this.mutate(result):!0}},notify:{help:["Similar to .tap() but it won't pass the current value as argument,","instead it will be provided as the `this` context when performing the","call. This allows it to be used with test runners `done` style callbacks.","Note that it will neither mutate the value even if it returns something."],desc:"notify {{arg1}}",test:function(actual,fn){return fn.call(actual),!0}},size:{help:["Forks the expectation to operate on the size of the current value."],desc:"get size",fail:"not has a length: {{ actual }}",test:function(actual){return _.isObject(actual)||_.isArray(actual)||_.isString(actual)?this.mutate(_.size(actual)):!1}},prop:{aliases:["key","property"],help:["Forks the expectation to operate on one of the value properties."],desc:"get property {{ arg1 }}",fail:"was not found on {{ actual }}",test:function(actual,key){return _.isObject(actual)?key in actual?this.mutate(actual[key]):(this.keys=[],_.forIn(actual,function(v,k){this.keys.push(k)},this),"was not found in keys {{ keys }}"):"got {{actual}}"}},at:{aliases:["index"],help:["Mutates the value to operate on one of the indexed elements. If","multiple indexes are provided an array is composed with them.","Note: It supports negative indexes"],desc:'get index ${ args.join(", ") }',test:function(actual,index){if(!_.isArray(actual)&&!_.isString(actual))return"not an array or a string: ${actual}";for(var indexes=_.toArray(arguments).slice(1),elems=[],i=0;i<indexes.length;i++){var idx=indexes[i];if(idx=0>idx?actual.length+idx:idx,0>idx||idx>=actual.length)return idx+" out of bounds for {{actual}}";elems.push(actual[idx])}return this.mutate(1===elems.length?elems[0]:elems)}},keys:{help:["Mutates the value to operate on its list of own keys."],desc:"get keys",test:function(actual){return this.mutate(_.keys(actual))}},values:{help:["Mutates the value to operate on its list of values"],desc:"get values",test:function(actual){return this.mutate(_.values(actual))}},slice:{help:["Extracts a portion from the value."],desc:"slice({{actual}}, ${arg1 || 0})",test:function(actual,start,end){return this.mutate(_.toArray(actual).slice(start,end))}},filter:{help:["Iterates over elements of the collection, forking the expectation to","operate on an array with all the elements for which the callback returned","truthy for.","See: https://lodash.com/docs#filter"],test:function(actual,callback,thisArg){return this.mutate(_.filter(actual,callback,thisArg))}},reject:{help:["Iterates over elements of collection, forking the expectation to operate","on an array with all the elements for which the callback returned falsy","for (the opposite of .filter).","See: https://lodash.com/docs#reject"],test:function(actual,callback,thisArg){return this.mutate(_.reject(actual,callback,thisArg))}},where:{help:["Performs a deep comparison of each element in a collection to the given","properties object, forking the expectation to operate on an array of all","elements that have equivalent property values.","See: https://lodash.com/docs#where"],desc:"where {{arg1}}",test:function(actual,props){return _.isPlainObject(props)?this.mutate(_.where(actual,props)):"props is not an object"}},map:{help:["Forks the expectation to operate on an array holding the results of","invoking the callback for each element in the current collection.","See: https://lodash.com/docs#map"],test:function(actual,callback,thisArg){return this.mutate(_.map(actual,callback,thisArg))}},method:{help:["Forks the expectation to operate on the result of invoking the named","method on the subject value."],desc:"method .${arg1}()",test:function(actual,method,arg){if("function"!=typeof actual[method])return"${arg1} is not a method in {{actual}}";var args=_.toArray(arguments).slice(2);return this.mutate(actual[method].apply(actual,args))}},invoke:{help:["Forks the expectation to operate on an array holding the results of","invoking the method named by the argument for each element in the","current collection.","See: https://lodash.com/docs#invoke"],desc:"invoke .${arg1}()",test:function(actual,method,arg){return this.mutate(_.invoke.apply(_,arguments))}},pluck:{help:["Mutates the value to be the one of the specific property for all elements","in the current collection.","See: https://lodash.com/docs#pluck"],desc:"pluck( {{arg1}} )",test:function(actual,prop){return this.mutate(_.pluck(actual,prop))}},first:{aliases:["head"],help:["TODO","See: https://lodash.com/docs#first"],desc:"get first element",test:function(actual){return this.mutate(_.head(actual))}},last:{help:["TODO","See: https://lodash.com/docs#last"],test:function(actual){return this.mutate(_.last(actual))}},rest:{aliases:["tail"],help:["TODO","See: https://lodash.com/docs#rest"],test:function(actual){return this.mutate(_.tail(actual))}},min:{help:["Mutates the subject to be the minimum value found on the collection.","See: https://lodash.com/docs#min"],test:function(actual){return this.mutate(_.min(actual))}},max:{help:["Mutates the subject to be the maximum value found on the collection.","See: https://lodash.com/docs#max"],test:function(actual){return this.mutate(_.max(actual))}},sort:{help:["Mutates the value to be sorted in ascending order.","See: https://lodash.com/docs#sortBy"],desc:"sort",test:function(actual,callback,thisArg){return callback instanceof ass.Chain&&(callback=callback.result),this.mutate(_.sortBy(actual,callback,thisArg))}},store:{help:["Helper to store a reference to the current value being evaluated in the","expression in some other object. It expects a target object and optionally","the name of a property. If target is a function it'll receive the value","using `prop` as this context. If `prop` is not provided and `target` is an","array the value will be pushed to it."],desc:"store",test:function(actual,target,prop){if(_.isFunction(target))target.call(prop,actual);else if(void 0===prop){if(!_.isArray(target))return"prop undefined and target is not an array or a function: {{arg1}}";target.push(actual)}else{if(!_.isObject(target))return"target is not an object: {{arg1}}";target[prop]=actual}return!0}}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});
},{"../ass":1,"../util":13}],8:[function(require,module,exports){(function(global){function resume(resolver,result){return function(value){resolver.resume(value,result)}}function isPromise(value){var then=value&&value.then;return"function"==typeof then}var _="undefined"!=typeof window?window._:"undefined"!=typeof global?global._:null,ass=require("../ass");ass.register({promise:{help:["Verifies that the value is a promise (Promise/A+) but does not attach","the expression to its resolution like `resolves` or `rejects`, instead","the original promise value is kept as the subject for the following","expectations."],desc:"to be a promise",fail:"got ${ actual }",test:function(actual){return isPromise(actual)}},resolves:{aliases:["resolved","fulfilled","fulfill","eventually"],help:["Attach the matcher to a promise value (Promises/A+) to continue","applying the chain of matchers once the promise has been resolved,","mutating the value to the resolved one.","It will fail if the value is not a promise (no .then method) or the","promise is actually rejected."],desc:"to be a resolved promise",fail:"was rejected",test:function(actual){return isPromise(actual)?function(resolver){return resolver.pause(),void actual.then(resume(resolver),resume(resolver,!1))}:"is not a promise: {{actual}}"}},become:{aliases:["becomes"],help:["Works the same as .resolves but additionally will do a comparison between","the resolved value from the promise and the expected one. It can be seen","as a shortcut for `.resolves.eq(expected)`."],desc:"to become {{ expected }}",fail:"was {{ actual }}",test:function(actual,expected){return isPromise(actual)?function(resolver){return resolver.pause(),void actual.then(function(value){var result=_.isEqual(value,expected)?void 0:!1;resolver.resume(value,result)},resume(resolver,!1))}:"is not a promise: {{actual}}"}},rejects:{aliases:["rejected"],help:["Attach the matcher to a promise value (Promises/A+) to continue applying","the chain of matchers once the promise has been rejected, mutating the","value to become the rejected error.","It will fail if the value is not a promise (no .then method) or the","promise is actually fulfilled."],desc:"to be a rejected promise",fail:"was fulfilled",test:function(actual){return isPromise(actual)?function(resolver){return resolver.pause(),void actual.then(resume(resolver,!1),resume(resolver))}:"is not a promise: {{actual}}"}}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../ass":1}],9:[function(require,module,exports){(function(global){function forker(resolver,actual,iterator,stop){var branches=_.size(actual),result=iterator(actual,function(value){var fork=resolver.fork(),partial=fork(value);return partial===stop?(resolver.join(fork),stop):partial===!stop?(branches-=1,0===branches&&resolver.join(fork),!stop):(resolver.paused||resolver.pause(),fork.finalize(function(final){return final===stop?(resolver.join(fork),resolver.resume(null,stop)):(branches-=1,0===branches&&(resolver.join(fork),resolver.resume(null,!stop))),final}),!stop)});return resolver.paused?void 0:resolver.finalize(result)}var _="undefined"!=typeof window?window._:"undefined"!=typeof global?global._:null,ass=require("../ass");ass.register({every:{aliases:["all","allOf"],help:["Applies matchers to all the elements in a collection expecting that","all of them succeed"],desc:"For every one:",fail:"one didn't",test:function(actual){return function(resolver){return resolver.exhausted?resolver.finalize(!0):forker(resolver,actual,_.every,!1)}}},some:{aliases:["anyOf"],help:["Applies matchers to all the elements in a collection expecting that","at least one of them succeeds"],desc:"At least one:",fail:"none did",test:function(actual){return function(resolver){return resolver.exhausted?resolver.finalize(!0):forker(resolver,actual,_.some,!0)}}},none:{aliases:["noneOf"],help:["Applies matchers to all the elements in a collection expecting that","none of them succeed."],desc:"None of them:",fail:"one did",test:function(actual){return function(resolver){return resolver.exhausted?resolver.finalize(!0):(resolver.finalize(function(final){return!final}),forker(resolver,actual,_.some,!0))}}}})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../ass":1}],10:[function(require,module,exports){var Chain=require("./chain"),util=require("./util"),checkChain=new Chain;exports.lodash=function(_){function cmp(a,b){return Chain.isChain(a)?a.test(b):Chain.isChain(b)?b.test(a):void 0}return _.createCallback(checkChain)===checkChain.test?_:(_.createCallback=_.wrap(_.createCallback,function(orig,callback,thisArg){if(Chain.isChain(callback))return callback.test;if(_.isPlainObject(callback)){var props=_.keys(callback);return function(object){if(null==object)return!1;for(var key,result=!1,length=props.length;length--;){if(key=props[length],!(key in object)){result=!1;break}if(result=_.isEqual(object[key],callback[key]),!result)break}return result}}return orig(callback,thisArg)}),_.isEqual=_.wrap(_.isEqual,function(orig,a,b,callback,thisArg){var result=callback?callback.call(thisArg||this,a,b):void 0;return void 0===result&&(result=orig(a,b,cmp,thisArg)),result}),_)},exports.sinon=function(sinon){if(sinon.match.isMatcher(checkChain))return sinon;var oldIsMatcher=util.bind(sinon.match.isMatcher,sinon.match);return sinon.match.isMatcher=function(obj){return Chain.isChain(obj)||oldIsMatcher(obj)},sinon}},{"./chain":2,"./util":13}],11:[function(require,module,exports){(function(global){function factory(){function fn(value){return resolver.call(fn,value)}return fn.id=++created,fn.chain=null,fn.parent=null,fn.paused=!1,fn.resolved=[],fn.finalizers=[],fn.pause=pause,fn.resume=resume,fn.fork=fork,fn.join=join,fn.finalize=finalize,Object.defineProperty(fn,"exhausted",{get:function(){return this.resolved.length>=this.chain.__expectations__.length}}),fn}function resolver(value){var list,result,exp;list=this.chain.__expectations__,offset=this.resolved.length,result=!0;for(var i=offset;i<list.length;i++){if(exp=util.create(list[i],{actual:value}),this.resolved.push(exp),result=exp.result=exp.resolve(),"function"==typeof result)return exp.result=result.call(exp,this),exp.result;if(result===!1)break}return this.finalize(result)}function pause(){if(this.paused)throw new Error("Resolver already paused");this.paused=!0}function resume(actual,override){if(!this.paused)throw new Error("Resolver is not currently paused");return this.paused=!1,void 0!==override?this.finalize(override):this(actual)}function fork(){var branch=acquire(this.chain);return branch.parent=this,branch.resolved=_.reject(this.resolved,Array.isArray),branch}function join(fork){var len=_.reject(this.resolved,Array.isArray).length;this.resolved.push(fork.resolved.slice(len))}function finalize(result){if("function"==typeof result)return void this.finalizers.push([result,_.last(this.resolved)]);if(void 0===result)return void 0;for(var finalizer;this.finalizers.length>0;)finalizer=this.finalizers.pop(),result=finalizer[0].call(finalizer[1],result),finalizer[1].result=result;if(this.parent||this.chain.dispatchResult(this.resolved,result),pool.push(this),pool.length>created)throw new Error("Pool corrupted! Created "+created+" but there are "+pool.length+" pooled");return result}function acquire(chain){var resolver=pool.pop()||factory();for(resolver.chain=chain,resolver.parent=null,resolver.paused=!1;resolver.resolved.length>0;)resolver.resolved.pop();for(;resolver.finalizers.length>0;)resolver.finalizers.pop();return resolver}var _="undefined"!=typeof window?window._:"undefined"!=typeof global?global._:null,util=require("./util"),pool=util.CappedPool(100),created=0;exports.acquire=acquire}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./util":13}],12:[function(require,module,exports){function should(name){if(null===name)return should.restore();if(name=name||DEFAULT_PROP,name in Object.prototype){if(!Chain.isChain(Object.prototype[name]))throw new Error("ass.should: Object.prototype already has a ."+name+" property")}else Object.defineProperty(Object.prototype,name,{get:function(){return Chain.isChain(this)?this:new Chain(this instanceof String||this instanceof Number?this.constructor(this):this instanceof Boolean?!!this:this)},set:function(value){Object.defineProperty(this,name,{value:value,enumerable:!0,configurable:!0,writable:!0})},configurable:!0,enumerable:!1}),Object.defineProperty(Chain.prototype,name,{get:function(){return this},configurable:!0})}var Chain=require("./chain"),DEFAULT_PROP="should";should.restore=function(name){name=name||DEFAULT_PROP,name in Object.prototype&&Chain.isChain(Object.prototype[name])&&(delete Object.prototype[name],delete Chain.prototype[name])},module.exports=should},{"./chain":2}],13:[function(require,module,exports){(function(process,global){function unansi(str){return str.replace(/\x1b\[(\d+;?)+[a-z]/gi,"")}function valueDumper(v){var value;return value=_.isNumber(v)||_.isNaN(v)||_.isBoolean(v)||_.isNull(v)||_.isUndefined(v)?"<"+v+">":_.isRegExp(v)?v.toString():_.isFunction(v)?v.displayName?v.displayName+"()":v.name?v.name+"()":"<function>":JSON.stringify(v),"[1;36m"+value+"[0m"}function template(tpl,context){var fn=compileTemplate(tpl);if(void 0===context)return fn;var origEscape=_.escape;try{return _.escape=valueDumper,fn(context)}finally{_.escape=origEscape}}function bind(fn,thisArg){return function(){return fn.apply(thisArg,arguments)}}function create(proto,values){return 0===arguments.length?this:(create.prototype=proto,_.assign(new create,values||{}))}function sift4(s1,s2,maxOffset){if(!s1||!s1.length)return s2?s2.length:0;if(!s2||!s2.length)return s1.length;for(var l1=s1.length,l2=s2.length,c1=0,c2=0,lcss=0,local_cs=0;l1>c1&&l2>c2;){if(s1.charAt(c1)==s2.charAt(c2))local_cs++;else{lcss+=local_cs,local_cs=0,c1!=c2&&(c1=c2=Math.max(c1,c2));for(var i=0;maxOffset>i;i++){if(l1>c1+i&&s1.charAt(c1+i)===s2.charAt(c2)){c1+=i,local_cs++;break}if(l2>c2+i&&s1.charAt(c1)===s2.charAt(c2+i)){c2+=i,local_cs++;break}}}c1++,c2++}return lcss+=local_cs,Math.round(Math.max(l1,l2)-lcss)}var _="undefined"!=typeof window?window._:"undefined"!=typeof global?global._:null;exports.Promise=global.Promise||("undefined"!=typeof window?window.window:"undefined"!=typeof global?global.window:null).Promise,exports.CappedPool=function(max){var pool=[];return max=max||Number.MAX_VALUE,Object.defineProperty(pool,"push",{value:function(v){this.length<max&&Array.prototype.push.call(this,v)}}),pool};var doColors=_.once(function(){if(void 0!==process.env.ASS_COLORS)return/true|on|yes|enabled?|1/i.test(process.env.ASS_COLORS);var karma=global.__karma__;if(karma&&karma.config&&"undefined"!=typeof karma.config.colors)return karma.config.colors;var Mocha=global.Mocha;if(void 0===Mocha&&require.resolve&&require.resolve("mocha")&&(Mocha="undefined"!=typeof window?window.Mocha:"undefined"!=typeof global?global.Mocha:null),void 0!==Mocha&&void 0!==Mocha.reporters&&void 0!==Mocha.reporters.Base)return Mocha.reporters.Base.useColors;if(void 0!==process.env.MOCHA_COLORS)return!0;if(/--color=always/.test(process.env.GREP_OPTIONS||""))return!0;var tty=require("tty");return tty.isatty(1)&&tty.isatty(2)}),compileTemplate=_.memoize(function(tpl){return _.template(tpl,null,{escape:/\{\{([\s\S]+?)\}\}/g})});exports.bind=bind,exports.create=create,exports.template=template,exports.unansi=unansi,exports.doColors=doColors,exports.sift4=sift4}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:16,tty:15}],14:[function(require,module,exports){(function(global){var ass=require("./lib/ass"),Chain=require("./lib/chain"),AssError=require("./lib/error"),should=require("./lib/should"),patches=require("./lib/patches");if(require("./lib/matchers/core"),require("./lib/matchers/coordination"),require("./lib/matchers/quantifiers"),require("./lib/matchers/promise"),ass.Chain=Chain,ass.Error=AssError,ass.patches=patches,ass.should=function(){return should(arguments.length>0?arguments[0]:void 0),ass},ass.should.restore=function(){return should.restore(arguments.length>0?arguments[0]:void 0),ass},patches.lodash("undefined"!=typeof window?window._:"undefined"!=typeof global?global._:null),global.sinon&&global.sinon.match)patches.sinon(global.sinon);else if(require.resolve)try{patches.sinon("undefined"!=typeof window?window.sinon:"undefined"!=typeof global?global.sinon:null)}catch(e){}module.exports=ass}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./lib/ass":1,"./lib/chain":2,"./lib/error":3,"./lib/matchers/coordination":6,"./lib/matchers/core":7,"./lib/matchers/promise":8,"./lib/matchers/quantifiers":9,"./lib/patches":10,"./lib/should":12}],15:[function(require,module,exports){},{}],16:[function(require,module,exports){function noop(){}var process=module.exports={};process.nextTick=function(){var canSetImmediate="undefined"!=typeof window&&window.setImmediate,canMutationObserver="undefined"!=typeof window&&window.MutationObserver,canPost="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(canSetImmediate)return function(f){return window.setImmediate(f)};var queue=[];if(canMutationObserver){var hiddenDiv=document.createElement("div"),observer=new MutationObserver(function(){var queueList=queue.slice();queue.length=0,queueList.forEach(function(fn){fn()})});return observer.observe(hiddenDiv,{attributes:!0}),function(fn){queue.length||hiddenDiv.setAttribute("yes","no"),queue.push(fn)}}return canPost?(window.addEventListener("message",function(ev){var source=ev.source;if((source===window||null===source)&&"process-tick"===ev.data&&(ev.stopPropagation(),queue.length>0)){var fn=queue.shift();fn()}},!0),function(fn){queue.push(fn),window.postMessage("process-tick","*")}):function(fn){setTimeout(fn,0)}}(),process.title="browser",process.browser=!0,process.env={},process.argv=[],process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")}},{}],17:[function(require,module,exports){function CallSite(frame){this.frame=frame}CallSite.prototype=Object.create({getLineNumber:function(){return this.frame.lineNumber},getColumnNumber:function(){return this.frame.columnNumber},getFileName:function(){return this.frame.fileName},getFunction:function(){return this.frame["function"]},getThis:function(){return null},getTypeName:function(){return null},getMethodName:function(){return this.frame.functionName?this.frame.functionName.split(".").pop():null},getFunctionName:function(){return this.frame.functionName},getEvalOrigin:function(){return null},isToplevel:function(){return!1},isEval:function(){return!1},isNative:function(){return!1},isConstructor:function(){return/^new(\s|$)/.test(this.frame.functionName)},toString:function(){var name=this.getFunctionName()||"<anonymous>",loc=this.getFileName()+":"+this.getLineNumber()+":"+this.getColumnNumber();return name+" ("+loc+")"}}),module.exports=CallSite},{}],18:[function(require,module,exports){(function(process,global){function Failure(message,sff){return this instanceof Failure?(this.sff=sff||this.constructor,this.message=message,this._getFrames=makeFramesGetter(this.sff),/\[native code\]/.test(Object.defineProperty)||(this.frames=unwind(this._getFrames()),this._getFrames=null,this.stack=this.generateStackTrace()),this):new Failure(message,sff||Failure)}function trim(frames,sff){var fn,name=sff.name;if(!frames)return console.warn("[Failure] error capturing frames"),[];for(var i=0;i<frames.length;i++)if(fn=frames[i].getFunction(),fn&&fn===sff||name&&name===frames[i].getFunctionName())return frames.slice(i+1);return frames}function unwind(frames){for(var fn,result=[],i=0;i<frames.length;i++)if(fn=frames[i].getFunction(),fn&&fn[SYMBOL_IGNORE]||result.push(frames[i]),fn&&fn[SYMBOL_FRAMES]){if(Failure.FRAME_EMPTY&&result.push(null),"function"==typeof fn[SYMBOL_FRAMES]){var getter=fn[SYMBOL_FRAMES];fn[SYMBOL_FRAMES]=null,fn[SYMBOL_FRAMES]=getter()}if(!fn[SYMBOL_FRAMES]){console.warn("[Failure] Empty frames annotation");continue}result.push.apply(result,unwind(fn[SYMBOL_FRAMES]));break}return result}function makeFramesGetterV8(sff){NativeError.captureStackTrace(V8FRAMES,sff||makeFramesGetterV8),sff=null;var frames=V8FRAMES.stack;return V8FRAMES.stack=null,V8FRAMES={},function(cleanup){var result=frames;return frames=null,result}}function makeFramesGetterCompat(sff){for(var error=getErrorWithStack(),caller=arguments.callee,functions=[getErrorWithStack],i=0;caller&&10>i&&(functions.push(caller),caller.caller!==caller);i++)caller=caller.caller;return caller=null,function(cleanup){var frames=null;if(!cleanup){frames=ErrorStackParser.parse(error);for(var i=2;i<frames.length;i++)frames[i]["function"]=functions[i],frames[i]=new CallSite(frames[i]);frames=trim(frames.slice(2),sff)}return sff=error=functions=null,frames}}function exclude(ctor,predicate){var fn=predicate;"string"==typeof predicate?fn=function(frame){return-1!==frame.getFileName().indexOf(predicate)}:"function"==typeof predicate.test&&(fn=function(frame){return predicate.test(frame.getFileName())}),ctor.excludes.push(fn)}var ErrorStackParser=require("error-stack-parser"),CallSite=require("./call-site"),NativeError=Error,SYMBOL_FRAMES="@@failure/frames",SYMBOL_IGNORE="@@failure/ignore";Failure.FRAME_EMPTY="  ----",Failure.FRAME_PREFIX="  at ",Failure.TRACKING=!0;var getErrorWithStack=function(){return new NativeError};getErrorWithStack().stack||(getErrorWithStack=function(){try{throw new NativeError}catch(e){return e}});var V8FRAMES={},makeFramesGetter="function"==typeof NativeError.captureStackTrace?makeFramesGetterV8:makeFramesGetterCompat,oldPrepareStackTrace=Error.prepareStackTrace;Error.prepareStackTrace=function(error,frames){if(error===V8FRAMES)return frames;if(oldPrepareStackTrace)try{return oldPrepareStackTrace.call(Error,error,frames)}catch(e){}return Failure.prototype.prepareStackTrace.call(error,unwind(frames))},Failure.excludes=[],Failure.exclude=exclude.bind(null,Failure),Failure.track=function Failure_track(fn,sff){return"function"!=typeof fn?fn:("function"==typeof fn[SYMBOL_FRAMES]&&fn[SYMBOL_FRAMES](!0),Failure.TRACKING&&(fn[SYMBOL_FRAMES]=null,fn[SYMBOL_FRAMES]=makeFramesGetter(sff||Failure_track)),fn)},Failure.wrap=function Failure_wrap(fn){var wrapper=Failure.ignore(function(){return fn.apply(this,arguments)});return Failure.track(wrapper,Failure_wrap)},Failure.ignore=function(fn){return fn[SYMBOL_IGNORE]=!0,fn},Failure.setTimeout=function Failure_setTimeout(){return arguments[0]=Failure.track(arguments[0],Failure_setTimeout),setTimeout.apply(null,arguments)},Failure.nextTick=function Failure_nextTick(){return arguments[0]=Failure.track(arguments[0],Failure_nextTick),process.nextTick.apply(process,arguments)},Failure.patch=function(obj,name,idx){if(obj&&"function"!=typeof obj[name])throw new Error('Object does not have a "'+name+'" method');var original=obj[name];"number"==typeof idx?obj[name]=function(){return arguments[idx]=Failure.track(arguments[idx],obj[name]),original.apply(this,arguments)}:obj[name]=function(){for(var i=0;i<arguments.length;i++)"function"==typeof arguments[i]&&(arguments[i]=Failure.track(arguments[i],obj[name]));return original.apply(this,arguments)};for(var k in original)original.hasOwnProperty(k)&&(obj[name][k]=original[k]);return obj[name]},Failure.create=function(name,props){function ctor(message,sff){return this instanceof Failure?void Failure.apply(this,arguments):new ctor(message,sff)}if("string"!=typeof name)throw new Failure("Expected a name as first argument");return ctor.excludes=[],ctor.exclude=function(predicate){exclude(ctor,predicate)},ctor.prototype=Object.create(Failure.prototype),ctor.prototype.constructor=ctor,ctor.prototype.name=name,"function"==typeof props?ctor.prototype.prepareStackTrace=props:props&&Object.keys(props).forEach(function(prop){ctor.prototype[prop]=prop}),ctor};var builtinErrorTypes=["Error","TypeError","RangeError","ReferenceError","SyntaxError","EvalError","URIError","InternalError"],builtinErrors={};Failure.install=function(){var root="object"==typeof window?window:global;return builtinErrorTypes.forEach(function(type){root[type]&&!builtinErrors[type]&&(builtinErrors[type]=root[type],root[type]=Failure.create(type))}),Failure},Failure.uninstall=function(){builtinErrorTypes.forEach(function(type){root[type]=builtinErrors[type]||root[type]})};var proto=Failure.prototype=Object.create(Error.prototype);proto.constructor=Failure,proto.name="Failure",proto.message="","function"==typeof Object.defineProperty&&(Object.defineProperty(proto,"frames",{get:function(){var frames=unwind(trim(this._getFrames(),this.sff));return Object.defineProperty(this,"frames",{value:frames,writable:!0}),this._getFrames=null,frames}}),Object.defineProperty(proto,"stack",{get:function(){var stack=this.generateStackTrace();return Object.defineProperty(this,"stack",{value:stack,writable:!0}),stack}})),proto.generateStackTrace=function(){var include,excludes=this.constructor.excludes,frames=[];excludes!==Failure.excludes&&excludes.push.apply(excludes,Failure.excludes);for(var i=0;i<this.frames.length;i++){if(include=!0,this.frames[i])for(var j=0;include&&j<excludes.length;j++)include&=!excludes[j].call(this,this.frames[i]);include&&frames.push(this.frames[i])}return oldPrepareStackTrace?(frames=frames.filter(function(x){return!!x}),oldPrepareStackTrace.call(Error,this,frames)):this.prepareStackTrace(frames)},proto.prepareStackTrace=function(frames){for(var lines=[this],i=0;i<frames.length;i++)lines.push(frames[i]?Failure.FRAME_PREFIX+frames[i]:Failure.FRAME_EMPTY);return lines.join("\n")},module.exports=Failure}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./call-site":17,_process:16,"error-stack-parser":20}],19:[function(require,module,exports){var Failure=require("./lib/failure");module.exports=Failure},{"./lib/failure":18}],20:[function(require,module,exports){!function(root,factory){"use strict";"function"==typeof define&&define.amd?define("error-stack-parser",["stackframe"],factory):"object"==typeof exports?module.exports=factory(require("stackframe")):root.ErrorStackParser=factory(root.StackFrame)}(this,function(StackFrame){"use strict";var FIREFOX_SAFARI_STACK_REGEXP=/(^|@)\S+\:\d+/,CHROME_IE_STACK_REGEXP=/\s+at .*(\S+\:\d+|\(native\))/;return{parse:function(error){if("undefined"!=typeof error.stacktrace||"undefined"!=typeof error["opera#sourceloc"])return this.parseOpera(error);if(error.stack&&error.stack.match(CHROME_IE_STACK_REGEXP))return this.parseV8OrIE(error);if(error.stack&&error.stack.match(FIREFOX_SAFARI_STACK_REGEXP))return this.parseFFOrSafari(error);throw new Error("Cannot parse given Error object")},extractLocation:function(urlLike){if(-1===urlLike.indexOf(":"))return[urlLike];var locationParts=urlLike.replace(/[\(\)\s]/g,"").split(":"),lastNumber=locationParts.pop(),possibleNumber=locationParts[locationParts.length-1];if(!isNaN(parseFloat(possibleNumber))&&isFinite(possibleNumber)){var lineNumber=locationParts.pop();return[locationParts.join(":"),lineNumber,lastNumber]}return[locationParts.join(":"),lastNumber,void 0]},parseV8OrIE:function(error){return error.stack.split("\n").filter(function(line){return!!line.match(CHROME_IE_STACK_REGEXP)},this).map(function(line){var tokens=line.replace(/^\s+/,"").split(/\s+/).slice(1),locationParts=this.extractLocation(tokens.pop()),functionName=tokens[0]&&"Anonymous"!==tokens[0]?tokens[0]:void 0;return new StackFrame(functionName,void 0,locationParts[0],locationParts[1],locationParts[2],line)},this)},parseFFOrSafari:function(error){return error.stack.split("\n").filter(function(line){return!!line.match(FIREFOX_SAFARI_STACK_REGEXP)},this).map(function(line){var tokens=line.split("@"),locationParts=this.extractLocation(tokens.pop()),functionName=tokens.shift()||void 0;return new StackFrame(functionName,void 0,locationParts[0],locationParts[1],locationParts[2],line)},this)},parseOpera:function(e){return!e.stacktrace||e.message.indexOf("\n")>-1&&e.message.split("\n").length>e.stacktrace.split("\n").length?this.parseOpera9(e):e.stack?this.parseOpera11(e):this.parseOpera10(e)},parseOpera9:function(e){for(var lineRE=/Line (\d+).*script (?:in )?(\S+)/i,lines=e.message.split("\n"),result=[],i=2,len=lines.length;len>i;i+=2){var match=lineRE.exec(lines[i]);match&&result.push(new StackFrame(void 0,void 0,match[2],match[1],void 0,lines[i]))}return result},parseOpera10:function(e){for(var lineRE=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,lines=e.stacktrace.split("\n"),result=[],i=0,len=lines.length;len>i;i+=2){var match=lineRE.exec(lines[i]);match&&result.push(new StackFrame(match[3]||void 0,void 0,match[2],match[1],void 0,lines[i]))}return result},parseOpera11:function(error){return error.stack.split("\n").filter(function(line){return!!line.match(FIREFOX_SAFARI_STACK_REGEXP)&&!line.match(/^Error created at/)},this).map(function(line){var argsRaw,tokens=line.split("@"),locationParts=this.extractLocation(tokens.pop()),functionCall=tokens.shift()||"",functionName=functionCall.replace(/<anonymous function(: (\w+))?>/,"$2").replace(/\([^\)]*\)/g,"")||void 0;functionCall.match(/\(([^\)]*)\)/)&&(argsRaw=functionCall.replace(/^[^\(]+\(([^\)]*)\)$/,"$1"));var args=void 0===argsRaw||"[arguments not available]"===argsRaw?void 0:argsRaw.split(",");return new StackFrame(functionName,args,locationParts[0],locationParts[1],locationParts[2],line)},this)}}})},{stackframe:21}],21:[function(require,module,exports){!function(root,factory){"use strict";"function"==typeof define&&define.amd?define("stackframe",[],factory):"object"==typeof exports?module.exports=factory():root.StackFrame=factory()}(this,function(){"use strict";function _isNumber(n){return!isNaN(parseFloat(n))&&isFinite(n)}function StackFrame(functionName,args,fileName,lineNumber,columnNumber,source){void 0!==functionName&&this.setFunctionName(functionName),void 0!==args&&this.setArgs(args),void 0!==fileName&&this.setFileName(fileName),void 0!==lineNumber&&this.setLineNumber(lineNumber),void 0!==columnNumber&&this.setColumnNumber(columnNumber),void 0!==source&&this.setSource(source)}return StackFrame.prototype={getFunctionName:function(){return this.functionName},setFunctionName:function(v){this.functionName=String(v)},getArgs:function(){return this.args},setArgs:function(v){if("[object Array]"!==Object.prototype.toString.call(v))throw new TypeError("Args must be an Array");this.args=v},getFileName:function(){return this.fileName},setFileName:function(v){this.fileName=String(v)},getLineNumber:function(){return this.lineNumber},setLineNumber:function(v){if(!_isNumber(v))throw new TypeError("Line Number must be a Number");this.lineNumber=Number(v)},getColumnNumber:function(){return this.columnNumber},setColumnNumber:function(v){if(!_isNumber(v))throw new TypeError("Column Number must be a Number");this.columnNumber=Number(v)},getSource:function(){return this.source},setSource:function(v){this.source=String(v)},toString:function(){var functionName=this.getFunctionName()||"{anonymous}",args="("+(this.getArgs()||[]).join(",")+")",fileName=this.getFileName()?"@"+this.getFileName():"",lineNumber=_isNumber(this.getLineNumber())?":"+this.getLineNumber():"",columnNumber=_isNumber(this.getColumnNumber())?":"+this.getColumnNumber():"";return functionName+args+fileName+lineNumber+columnNumber}},StackFrame})},{}]},{},[14])(14)});